# Nightly jellybean building script
#
# for benjamingwynn's jellybean marvel builds.

#- Make sure we are using the script correctly, if we aren't then throw errors...

if [ "$1" = "-u" ]
  then
     echo "FATAL: -u flag given before marvel/marvelc flag."
     echo " "
     echo "For usage, type -?"
     exit
fi

if [ "$1" = "" ]
  then
     echo "FATAL: No flags given, stopping."
     echo " "
     echo "For usage, type -?"
     exit
fi

#- jellyhelp :)

if [ "$1" = "-?" ]
  then
     echo "jelly | A simple compiling script"
     echo "Created by Benjamin Gwynn"
     echo " "
     echo "Usage: ./jelly [device] [flags]"
     echo " "
     echo "-u    Upload"
     exit
fi

#- ...otherwise, carry on.
echo "Jellybean Nightly build script"
echo " "
echo "Working..."
cd ~/cm-jb
source build/envsetup.sh; 
export USE_CCACHE=1
if [ "$1" = "marvel" ]
  then
     echo "Compile for the marvel..."
     lunch cm_marvel-eng
fi
if [ "$1" = "marvelc" ]
  then
     echo "Compile for the marvelc..."
     lunch cm_marvelc-eng
fi
echo "Syncing..."
repo sync
echo "Cleaning..."
make clean
make clobber
echo "Compiling..."
make -j8 bacon
echo "Setting dates..."
a="$(date +%Y%m%d)"
b="$(date +%d-%m-%Y)"
if [ "$2" = "-u" ]
  then
    if [ -f $b ]
      then
        echo "Jellybean has already been built today, not uploading"
        clear
        echo "Done! Build wasn't uploaded."
      else
        touch $b
        echo "Uploading to goo.im..."
        scp -P 2222 out/target/product/marvel/"cm-10-"$a"-EXPERIMENTAL-marvel-CM-10-NIGHTLY-"$b".zip" benjamingwynn@upload.goo.im:public_html/jb-builds/"cm-10-marvel-"$b".zip"
        clear
        echo "Done! Build is at http://goo.im/devs/benjamingwynn/jb-builds"
    fi
else
    echo "-u flag not given, not uploading."
    clear
    echo "Done! Build wasn't uploaded."
fi
echo " "
